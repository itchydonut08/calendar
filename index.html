<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Google Calendar Integration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://apis.google.com/js/api.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button { padding: 10px 20px; margin: 10px 0; }
    #calendarEvents { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Google Calendar Connection</h1>
  <button id="authorize_button">Sign In with Google</button>
  <button id="signout_button" style="display:none;">Sign Out</button>
  <div id="calendarEvents"></div>

  <script>
    const CLIENT_ID = '530875477700-s2ebm4u8qcm0dhgq78kk16r6loaab0t2.apps.googleusercontent.com';
    const API_KEY = ''; // Not required for this example
    const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
    const SCOPES = "https://www.googleapis.com/auth/calendar.readonly";

    const authorizeButton = document.getElementById('authorize_button');
    const signoutButton = document.getElementById('signout_button');

    function updateSigninStatus(isSignedIn) {
      if (isSignedIn) {
        authorizeButton.style.display = 'none';
        signoutButton.style.display = 'inline-block';
        listUpcomingEvents();
      } else {
        authorizeButton.style.display = 'inline-block';
        signoutButton.style.display = 'none';
      }
    }

    function handleAuthClick() {
      gapi.auth2.getAuthInstance().signIn();
    }

    function handleSignoutClick() {
      gapi.auth2.getAuthInstance().signOut();
      localStorage.removeItem('gapi_signed_in');
    }

    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        discoveryDocs: DISCOVERY_DOCS,
        scope: SCOPES
      }).then(() => {
        const authInstance = gapi.auth2.getAuthInstance();
        const signedIn = authInstance.isSignedIn.get();

        updateSigninStatus(signedIn);
        authInstance.isSignedIn.listen(updateSigninStatus);

        if (localStorage.getItem('gapi_signed_in') === 'true' && !signedIn) {
          authInstance.signIn(); // try to silently restore session
        }

        if (signedIn) {
          localStorage.setItem('gapi_signed_in', 'true');
        }
      });
    }

    function listUpcomingEvents() {
      gapi.client.calendar.events.list({
        calendarId: 'primary',
        timeMin: (new Date()).toISOString(),
        showDeleted: false,
        singleEvents: true,
        maxResults: 5,
        orderBy: 'startTime'
      }).then(response => {
        const events = response.result.items;
        const output = document.getElementById('calendarEvents');
        output.innerHTML = '<h3>Upcoming Events</h3>';
        if (events.length) {
          events.forEach(event => {
            const when = event.start.dateTime || event.start.date;
            output.innerHTML += `<p><strong>${event.summary}</strong> - ${when}</p>`;
          });
        } else {
          output.innerHTML += '<p>No upcoming events found.</p>';
        }
      });
    }

    gapi.load('client:auth2', initClient);

    authorizeButton.onclick = handleAuthClick;
    signoutButton.onclick = handleSignoutClick;
  </script>
</body>
</html>
